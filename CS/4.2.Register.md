# 4.2 Register
## 반드시 알아야 할 레지스터
상용화 된 CPU들이 표기하는, 내포하는 레지스터들은 각기 다르게 명칭되었거나 다른 종류로 구성되어있다. 그러나 전공서적들에서 중요하게 여기고 대다수의 CPU에서 공통으로 포함하는 여덟 개의 레지스터들을 소개 및 설명한다.
1. 프로그램 카운터(PC; Program Counter) : 프로그램 카운터는 현재 메모리 에서 불러올 명령어의 "주소"를 저장하는 레지스터이다.
2. 명령어 레지스터(IR; Instruction Register) : 해석할 명령어, 즉 방금 메모리에서 읽어 들인 명령어를 저장하는 레지스터이다.
3. 메모리 주소 레지스터(Memory Address Register) : 메모리 주소 레지스터는 읽을 "메모리 주소"를 저장하는 레지스터이다. CPU가 읽어들일 주소 값을 주소 버스로 보낼 때 해당 레지스터를 거치게 된다.
4. 메모리 버퍼 레지스터(Memory Buffer Register) : MAR과 유사한 이름에서 볼 수 있듯, 메모리 버퍼 레지스터는 메모리와 "주고받을 값(데이터와 명령어)"을 저장하는 레지스터이다. 즉, 메모리에 쓰고 싶은 값이나 읽어들인 값을 해당 레지스터에 저장한다. CPU가 데이터 버스로 주고받는 값이 메모리 버퍼 레지스터를 거친다.
5. 범용 레지스터(General Purpose Register) : 특정한 목적을 가진 레지스터들과 달리 다양하고 일반적인 상황에서 사용할 수 있는 레지스터로 범용적으로 "주소값", "데이터" 모두 저장할 수 있다.
6. 플래그 레지스터(Flag Register) : ALU에서 나온 연산결과 또는 CPU의 상태에 대한 추가적인 정보를 제공하는 "플래그"를 저장하는 레지스터이다.
7. 스택 포인터(Stack Pointer) : 오퍼랜드의 주소 지정 방식 중 하나인 "스택 주소 지정 방식"에서 사용되는 레지스터로 스택의 최상단에 저장된 값의 위치를 저장한다. 
8. 베이스 레지스터(Base Register) : 오퍼랜드의 주소 지정 방식 중 하나인 "베이스 레지스터 주소 지정 방식"에서 사용되는 레지스터로 "기준 주소"를 저장한다.

## 명령어를 해석하는 과정
제어장치에서 명령어를 해석하기 위해서는 메모리에서 명령어를 읽어와 명령어 레지스터에 저장하는 작업이 선행되어야 한다. 이 과정에 프로그램 카운터, 메모리 주소 레지스터, 메모리 버퍼 레지스터, 명령어 레지스터가 사용된다. 차근차근 과정을 알아가 보자.
1. 먼저 선행조건으로 메모리에는 CPU가 실행할 프로그램이 저장되어 있다.
2. 프로그램 카운터가 실행할 프로그램의 시작 주소를 저장한다.
3. 시작 주소를 메모리에서 읽어오기 위해 메모리 주소 레지스터에 시작 주소를 저장한다.
4. 제어장치에서 "메모리 읽기" 제어신호를 "제어버스"를 통해 메모리로 내보내고 메모리 주소 레지스터 또한 "주소버스"로 읽어들일 주소값을 메모리로 내보낸다.
5. 메모리에서 읽어들인 값은 "데이터버스"를 통해 메모리 버퍼 레지스터로 저장되고 *프로그램 카운터는 증가되어 다음 명령어를 읽어 들일 준비를 한다.*
6. 메모리 버퍼 레지스터에 저장된 데이터는 결과적으로 우리가 실행 할 명령어이므로 이를 명령어 레지스터로 이동시킨다.
7. 제어장치는 명령어 레지스터의 명령어를 해석하고 제어 신호를 발생시킨다.
8. 다음 명령어를 읽어들인다(2~7을 반복).

## 특정 레지스터를 이용한 주소 지정 방식
### 1. 스택 주소 지정 방식
앞서 설명했듯 스택 포인터는 스택 주소 지정 방식에서 활용된다. 스택은 메모리 안에 있다. 조금 더 정확히 말하면 메모리 안에 스택처럼 사용할 영역이 정해져 있으며 이를 **스택 영역**이라고 한다.

### 2. 변위 주소 지정 방식
변위 주소 지정 방식은 명령어를 구성하는 요소 중 하나인 "오퍼랜드"에 저장된 값(변위)과 특정 레지스터의 값을 더해 유효 주소를 얻어내는 주소 지정 방식이다. 상대 주소 지정 방식과 베이스 주소 지정 방식 등으로 나뉘게 되며 상대 주소 지정 방식과 베이스 주소 지정 방식을 추가로 설명한다.

> 상대 주소 지정 방식

오퍼랜드의 값과 프로그램 카운터에 저장된 주소를 더해 유효 주소를 얻는 방식이다. 오퍼랜드에 음수, 가령 -3이 저장되어 있다면 CPU는 읽어 들이기로 한 명령어로부터(프로그램 카운터에 저장된) "세 번지 이전" 번지로 접근한다; 양수일 경우 "n 번째 이후" 번지로 접근한다. 후에 설명할 베이스 주소 지정 방식과는 다르게 시점에 따라 변화하는(상대적인) 프로그램 카운터에 저장된 주소와 더한다.

> 베이스 주소 지정 방식

6장에서 더 자세히 베이스 레지스터에 대해 공부하지만 간단히 표현하자면 "기준 주소"를 베이스 레지스터에 저장하고 오퍼랜드에 "기준 주소로부터 떨어진 거리"를 저장해 어떠한 주소에 접근할 것인지를 연산하여 유효 주소를 얻어낸다.


----
### 출처
* 혼공컴운 교재