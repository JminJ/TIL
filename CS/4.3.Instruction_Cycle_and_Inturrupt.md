# 4.3 명령어 사이클과 인터럽트

## 1. 명령어 사이클
명령어를 처리하는 과정에는 어떤 정해진 흐름이 있으며 이 흐름이 반복됨으로써 우리의 프로그램이 실행된다. 이를 명령어 사이클(instruction cycle)이라고 부른다.

1. 인출 사이클(fetch cycle) : 메모리에 저장된 명령어를 CPU로 불러오는 과정.
2. 실행 사이클(execution cycle) : CPU의 명령어 레지스터에 불러온 명령어를 해석하고 제어장치에서 제어신호를 발생시키는 과정.
3. 간접 사이클(indirect cycle) : 오퍼랜드에 메모리 주소 등을 저장하고 있어 다시 메모리에 접근해야 할 때의 과정.
4. 인터럽트 사이클(interrupt cycle) : 인터럽트를 처리하고 다시 실행중이던 명령어로 돌아오는 과정.

## 2. 인터럽트
인터럽트는 작업을 수행중인 CPU를 잠깐 멈추게 할 수 있다. 마치 회사 업무를 수행 중 더 중요한 업무가 들어와 진행중이던 업무를 멈춰두고 급한 일부터 처리하는 것과 비슷하다. 인터럽트의 종류에는 크게 두 가지 종류가 있다. "동기 인터럽트"와 "비동기 인터럽트"이다.

### 2-1. 동기 인터럽트(synchronous interrupts)
동기 인터럽트는 CPU에 의해 발생하는 인터럽트이다. CPU가 명령어를 실행 중 예상치 못한 상황에 마주쳤을 떄 발생된다. 대표적인 예는 프로그래밍 상의 오류와 같은 상황이다. 이런 점에서 동기 인터럽트는 **예외(exeption)** 라고 부른다. 

### 2-2. 비동기 인터럽트(asynchronous interrupts)
비동기 인터럽트는 주로 입출력장치에 의해 발생하는 인터럽트로 주로 알림같은 기능을 수행한다. 입출력장치가 CPU에게 작업이 완료되었다는 알림을 보낸다. 해당 교재에서는 "하드웨어 인터럽트"라는 표현을 사용할 것이다. 

**2-2-1. 하드웨어 인터럽트**

하드웨어 인터럽트는 앞서 설명했듯 작업이 완료되었다는 알림을 보냄으로써 CPU가 효율적으로 명령어를 수행할 수 있도록 한다; *가령 입출력장치가 완료 알림을 보내는 형식이 아니라 CPU가 입출력장치에게 작업완료 여부를 주기적으로 보낼 경우 아주 조금의 시간이라고 해도 묻는동안은 CPU가 다른 작업을 수행할 수 없게 되고 결국 CPU 사이클 낭비가 될 것이다.*

**2-2-2. 하드웨어 인터럽트 처리 순서**

하드웨어 인터럽트를 처리하는 순서는 아래와 같다.

1. 입출력장치는 CPU에게 **인터럽트 요청 신호** 를 보낸다.
2. CPU는 실행 사이클이 끝나고 명령어를 인출하기 전 항상 인터럽트 여부를 확인한다.
3. CPU는 인터럽트 요청을 확인하고 **인터럽트 플래그** 를 통해 현재 인터럽트를 받아들일 수 있는지 여부를 확인한다.
4. 인터럽트를 받아들일 수 있을 시, CPU는 지금까지의 작업을 백업한다.
5. CPU는 **인터럽트 벡터** 를 참조하여 **인터럽트 서비스 루틴** 을 수행한다.
6. 인터럽트 서비스 루틴이 끝나면 4.에서 백업해둔 작업을 복구해 실행을 재개한다.

각 단계마다 중요한 키워드들에 대한 설명을 추가한다.
* 인터럽트 요청 신호 : 인터럽트는 CPU의 작업 흐름을 끊는 것이기 때문에 먼저 CPU에게 인터럽트 발생 가능 여부를 물어봐야 한다. 이때 인터럽트 요청 신호를 보낸다.

* 인터럽트 플래그 : 플래그 레지스터에 저장되는 플래그의 한 종류로 하드웨어 인터럽트를 받아들일지 무시할지를 결정한다. CPU가 중요한 작업을 처리해야 하거나 어떤 방해도 받지 않아야 할 경우 인터럽트 플래그는 "불가능"으로 설정된다; *다만 하드웨어 고장이나 정전과 같은 가장 우선순위가 높은 인터럽트들은 불가능으로 설정되어있다 해도 무시할 수 없다.*

* 인터럽트 서비스 루틴 : 각 입출력장치가 발생시키는 인터럽트마다 수행되어야 할 작업이 다르다. 이와 같이 어떤 인터럽트가 발생했을 때 어떻게 작동해야 할지에 대한 정보로 이루어진 프로그램이다.

* 인터럽트 벡터 : 인터럽트 서비스 루틴도 어디까지나 프로그램이기에 메모리 어딘가에 저장이 되어있다. 그 중에서도 각 서비스 루틴이 어디서부터 시작하는지를 알아야 인터럽트에 맞는 루틴을 실행시킬 수 있을 것인데 이때 사용되는 것이 인터럽트 벡터이다. 인터럽트 벡터를 알면 인터럽트 서비스 루틴의 시작 주소를 알 수 있기에 각 루틴을 식별할 수 있다.
